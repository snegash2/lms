{% extends "_base.html" %}
{% load static %}
{% load embed_video_tags %}
{% block style %} 
    


    <link rel="stylesheet" href="{% static 'cstyles.css' %}" />
    <!-- <link rel="stylesheet" href="{% static 'cstayless.css' %}" /> -->
    <link rel="stylesheet" href="{% static 'cstudentindex.css' %}" />

    <link rel="stylesheet" href="{% static 'footer.css' %}" />
    <link rel="stylesheet" href="{% static 'studentnewmenu.css' %}" />
    <link rel="stylesheet" href="{% static 'note.css' %}" />
    <link rel="stylesheet" href="{% static 'newplaylist.css' %}" />
    <link rel="stylesheet" href="{% static 'video.css' %}" />

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.14.0/dist/sweetalert2.all.min.js"></script>
    <style>
      .modal {
        display:    none;
        position:   fixed;
        z-index:    1000;
        top:        0;
        left:       0;
        height:     100%;
        width:      100%;
        background: rgba( 255, 255, 255, .8 )
        url('https://i.stack.imgur.com/FhHRx.gif')
        50% 50%
        no-repeat;
    }
    body.loading {
        overflow: hidden;
    }
    body.loading .modal {
        display: block;
    }
    
    body {
      background-color: #e1e1e1;
    }



    * {
      font-family: "Kanit", sans-serif;
    }

    .popup-icons {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #079a85;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .popup-icons:hover {
      background-color: #079a85;
    }

    /* SweetAlert styles */
    .swal2-popup {
      font-size: 16px;
      position: absolute; /* Set position to absolute */
    }

    /* Custom Animation */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    /* Additional SweetAlert styles */
    .swal2-icon-success {
      animation: fadeIn 0.5s ease;
    }

    .swal2-title {
      color: #079a85;
    }

    .swal2-confirm-popup-icons {
      background-color: #079a85;
      color: #fff;
      transition: background-color 0.3s ease;
    }

    .swal2-confirm-popup-icons:hover {
      background-color: #218838;
    }

    /* Custom close icon styles */
    .swal2-close {
      font-size: 20px;
      color: #079a85;
      animation: fadeIn 0.5s ease;
    }

    .swal2-close:hover {
      color: #079a85;
    }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.14.0/dist/sweetalert2.all.min.js"></script>

{%endblock %}
{% block title %}
{{ object.title }}
{% endblock %}
{% block content %}
 
    {% with category=object.course_name.category  %}

    <script>
      // ====================================================click drop down icon anywhere==========================

      const dropdown = document.querySelector(".dropdown");

      document.addEventListener("click", (event) => {
        // Close the dropdown if clicked outside the dropdown
        if (!dropdown.contains(event.target)) {
          closeDropdown();
        }
      });

      dropdown
        .querySelector(".dropdown-toggle")
        .addEventListener("click", (event) => {
          event.stopPropagation(); // Prevent the document listener from triggering
          toggleDropdown();
        });

      function toggleDropdown() {
        dropdown.classList.toggle("show");
      }

      function closeDropdown() {
        dropdown.classList.remove("show");
      }
    </script>
    <div class="dashboard-container">
      <div id="left" class="course">
        <h2>{{course|title}}</h2>

        {% for module in course.modules.all %}
        <!-- ====================================Introduction One============================================ -->
        <div class="accordion">
          <div id="module-one" class="accordion-item">
            <div class="accordion-header">
              <!-- <i class="fas fa-angle-right"></i> -->
              <img src="{% static 'files.png' %}" /> Module:{{module.order}} {{module.detail }}
              <i class="fas fa-angle-right"></i>
            </div>
            <div class="accordion-content">
              <p></p>
              <div class="sub-accordion">
                <div class="sub-accordion-item">
                  <!-- <div id="sub-accordion-header" class="sub-accordion-header">
                    <img src="./assets/newfile.png" />Resources
                    <i id="Sub-video" class="fas fa-angle-right"></i>
                  </div> -->
                  <div class="sub-accordion-content"></div>
                </div>

                <div class="sub-accordion-item">
                  <div id="sub-accordion-header" class="sub-accordion-header">
                    <img src="{% static 'video-icons.png' %}" />Video<i
                      id="Sub-video"
                      class="fas fa-angle-right"
                    ></i>
                  </div>

                  <div class="sub-accordion-content">

                 
                    
                    <div class="video-list">

                     {% for content in  module.contents.all %}
                      {% if  content.content_type.model == "video"  %}
                        {% video content.item.video  as my_video %}
                        {{content.item.video}}
                        {% video my_video "small" %}
                       {% endvideo %}
                      {% endif %}
                          
                    {% endfor %}
                    </div>

                   
                  </div>
                </div>

                <div class="sub-accordion-item">
                  <div class="sub-accordion-header">
                    <img src="{% static 'referance-icons.png' %}" /> Reference<i
                      id="Ref-icons"
                      id="Ref-icons"
                      class="fas fa-angle-right"
                    ></i>


                  </div>
                  <div class="sub-accordion-content">

                    {%if request.user.is_authenticated %}
                      {% if request.user in course.students.all%}
                      
                    {% for content in  module.contents.all %}
                      {% if  content.content_type.model == "file"  %}

                       <a href="/{{content.item.file}}" target="_blank" rel="noopener noreferrer"> {{content.item.file}}</a>
          
                      {% endif %}
                          
                    {% endfor %}

                      {%endif%}

                    {%endif%}
                      
                  </div>
                </div>
                <!-- Add more sub-accordion items here as needed -->
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
        <!--  -------------------------------Accordion Js-------------------------------p------>
        <script>
          const accordions = document.querySelectorAll(
            ".accordion .accordion-item .accordion-header"
          );
          accordions.forEach((accordion) => {
            accordion.addEventListener("click", function () {
              const content = this.nextElementSibling;
              const icon = this.querySelector("i");
              content.style.display =
                content.style.display === "block" ? "none" : "block";

              // Change the icon
              if (content.style.display === "block") {
                icon.classList.remove("fa-angle-right");
                icon.classList.add("fa-angle-down");
              } else {
                icon.classList.remove("fa-angle-down");
                icon.classList.add("fa-angle-right");
              }

              // Close other open accordions
              accordions.forEach((otherAccordion) => {
                if (otherAccordion !== accordion) {
                  otherAccordion.nextElementSibling.style.display = "none";
                  const otherIcon = otherAccordion.querySelector("i");
                  otherIcon.classList.remove("fa-angle-down");
                  otherIcon.classList.add("fa-angle-right");
                }
              });
            });
          });

          const subAccordions = document.querySelectorAll(
            ".sub-accordion .sub-accordion-item .sub-accordion-header"
          );
          subAccordions.forEach((subAccordion) => {
            subAccordion.addEventListener("click", function () {
              const content = this.nextElementSibling;
              const icon = this.querySelector("i");
              content.style.display =
                content.style.display === "block" ? "none" : "block";

              // Change the icon
              if (content.style.display === "block") {
                icon.classList.remove("fa-angle-right");
                icon.classList.add("fa-angle-down");
              } else {
                icon.classList.remove("fa-angle-down");
                icon.classList.add("fa-angle-right");
              }

              // Close other open sub-accordions
              subAccordions.forEach((otherSubAccordion) => {
                if (otherSubAccordion !== subAccordion) {
                  otherSubAccordion.nextElementSibling.style.display = "none";
                  const otherIcon = otherSubAccordion.querySelector("i");
                  otherIcon.classList.remove("fa-angle-down");
                  otherIcon.classList.add("fa-angle-right");
                }
              });
            });
          });
        </script>
        <!-- ==========================================Attach File====================================== -->
        {% if request.user.is_authenticated and request.user in course.students.all %}

       
            <div id="left" class="attach">
              <div id="Attach" class="container">
                <h1>Attach File</h1>
                <form id="fileForm" method="post" enctype="multipart/form-data" >
                  {% csrf_token %}
                  <label for="fileInput">Select a file:</label>
                  <input type="file" id="fileInput" name="fileInput" required />

                  <button class="Upload__btns">Upload</button>
                  <div class="modal"><!-- Place at bottom of page --></div>

                </form>
                <div id="selectedFile"></div>
              </div>
            </div>
          </div> 
         

          <script>
            const form = document.getElementById("fileForm")
            form.addEventListener ("submit",function(envent){
              event.preventDefault();
                  //var formData = $(this).serialize();
                  $('body').addClass('loading')
                  const formData = new FormData(form);
                  const formDataObj = Object.fromEntries(formData.entries());
                  let data = {}
                  if(formDataObj){
                      data = JSON.stringify(formDataObj);
                  }

              
              axios.post("{% url 'courses:course_detail' course.slug %}", formData, {
          
                headers: {
                  'Content-Type': 'application/octet-stream',
                  'X-CSRFToken': '{{ csrf_token }}'
                },
             
           
              })
              .then((response) => {
                $('body').removeClass('loading')
                showSuccessMessage("success","Uploaded successfully","you uploaded successfully",3000)

              })
              .catch((error) => {
                setInterval("$('body').removeClass('loading')", 4000);
              })
            
            })

            function showSuccessMessage(icon,title,message,timer) {
              Swal.fire({
                icon: icon,
                title: title,
                text: message,
                confirmButtonColor: "#079a85", // Bootstrap success color
                timer: timer, // Auto-close the popup after 3000 milliseconds (3 seconds)
                showCloseButton: true, // Show close button
              });
            }
      

          </script>
       {% else %}

       <div id="left" class="attach">
        <div id="Attach" class="container">
          <h1>Your crendetials</h1>
          <form id="fileForm" aria-disabled="true">
            <!-- <label for="fileInput">Select a file:</label> -->
            <!-- <input type="file" id="fileInput" name="fileInput" /> -->

            <!-- <button class="Upload__btns">Upload</button> -->
          </form>
          <div id="selectedFile"></div>
        </div>
      </div>
    </div>

      {% endif %}
      <!-- ============================================== -->

      <div id="right" class="course-overview">
        <h2>Course Overview</h2>
        <div class="course-list">
          <!-- Course 1 -->
          <div class="course">
            <h3 class="course-header">{{course.name|truncatechars:20}}</h3>
            <div id="Display" class="video">
              <div class="main-video">
                <div class="video">

                {% if course.intro_video %}


                  {% video course.intro_video  as my_video %}
                  {{course.intro_video.url}}
  
                
                  {% video my_video "medium" %}
                 {% endvideo %}
               
                

                  {% else %}
                    <video
                    src="#"
                    controls
                    muted
                    
                  ></video>

                  {%endif%}

                  <h3 class="title">01.Biomedical</h3>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="right" class="discription">
          <div id="filters" class="filter-buttons">
            <button class="filter-button active" data-filter="button1">
              Overview
            </button>
            <button class="filter-button" data-filter="button2">
              Learning tools
            </button>
            <button class="filter-button" data-filter="button3">
              Upcoming tasks
            </button>
            <a href="{% url 'forum:index' %}" target="_blank" rel="noopener noreferrer">
              <button class="filter-button" data-filter="button4">
                Discussion form 
              </button>
            </a>
            <button class="filter-button" data-filter="button5">Note</button>
          </div>
          <div class="items">
            <div class="item button1">
              <h4>About course</h4>
              <p>
                {{ object.overview|safe|linebreaks }}
              </p>
              <ul>
                <li>Skill level: {{course.skill_level}}</li>
                <li>Students: {{course.students.count }}</li>
                <li>Languages: English</li>
                <li>Lectures: {{course.modules.all.count }}</li>
             
              </ul>
            </div>
            <div class="item button2">
              <div id="pdf-list">
                <h1>Pdf Files</h1>
                <ul id="dynamic-list">
                  {% if request.user in course.students.all and request.user.is_authenticated  %}


                  
                    {% for module in course.modules.all %}
                      
                      {% for content in module.contents.all %}
                              <p>{{content.item.title}}</p>

                            {% if content.content_type.model == 'video'%}
                                        {% video content.item.video  as my_video %}
                                        {% video my_video "small" %}
                                        {% endvideo %}

                            {% endif %}

                    
                          <li>
                          
                            <a href="{{content.item.file}}">
                            {{content.title}}
                            <img class="pdf-icon" src="{% static '{{content.content_type.model}}.jpg' %}" alt="">
                          </a>
                          </li>
                      
                      {% endfor %}
                    {% endfor %}

                  {% endif %}

                </ul>
              </div>

      


            </div>
            <div class="item button3">



              <ul>
                {% for module in course.modules.all %}
                  {% for task in module.tasks.all %}

                    <h4>Module:{{module.order}}</h4>
                    <p>{{task.title}}</p>

                    <li>
                       {{task.description}}
                    </li>
                    <li>
                      Description: {{task.task}}
                    </li>
                  {% endfor %}

                {% endfor %}

           
              </ul>
            </div>



            <div class="item button4">
              <div class="qna-container">
                <!-- <h1>Discussion form</h1> -->
                <div class="qna-form">
                  <h3 class="ask-header">Ask a Question</h3>
                  <textarea
                    id="question-title"
                    placeholder="Question Title"
                  ></textarea>
                  <textarea
                    class="First-text"
                    id="question-content"
                    placeholder="Question Content"
                  ></textarea>
                  <button id="ask-button">Ask</button>
                </div>
                <div class="qna-list" id="qna-list"></div>
              </div>
            </div>
            <div class="item button5">
              <div class="note-container container my-3">
                <div class="">
                  <div class="card-body">
                    <h5 class="card-title">Add a Note</h5>
                    <div class="form-group">
                      <textarea class="form-control" id="addTxt" rows="3">
                      </textarea>
                    </div>
                    <button class="" id="addBtn">Add Note</button>
                  </div>
                </div>
                <h1>Your Notes List</h1>

                <div id="notes" class="row container-fluid"></div>
              </div>

              <script>
                showNotes();

                // If user adds a note, add it to the localStorage
                let addBtn = document.getElementById("addBtn");
                addBtn.addEventListener("click", function (e) {
                  let addTxt = document.getElementById("addTxt");
                  let notes = localStorage.getItem("notes");

                  if (notes == null) notesObj = [];
                  else notesObj = JSON.parse(notes);

                  notesObj.push(addTxt.value);
                  localStorage.setItem("notes", JSON.stringify(notesObj));
                  addTxt.value = "";

                  showNotes();
                });

                // Function to show elements from localStorage
                function showNotes() {
                  let notes = localStorage.getItem("notes");

                  if (notes == null) notesObj = [];
                  else notesObj = JSON.parse(notes);

                  let html = "";

                  notesObj.forEach(function (element, index) {
                    html += `<div class="noteCard my-2 mx-2 card" 
                          style="">
                              <div class="card-body">
                                  <h5 class="card-title">
                                      Note ${index + 1}
                                  </h5>
                                  <p class="card-text"> 
                                      ${element}
                                  </p>
                 
                                <button id="${index}" onclick=
                                  "deleteNote(this.id)"
                                  class="btn btn-primary">
                                  Delete Note
                              </button>
                          </div>
                      </div>`;
                  });

                  let notesElm = document.getElementById("notes");

                  if (notesObj.length != 0) notesElm.innerHTML = html;
                  else notesElm.innerHTML = ``;
                }

                // Function to delete a note
                function deleteNote(index) {
                  let notes = localStorage.getItem("notes");

                  if (notes == null) notesObj = [];
                  else notesObj = JSON.parse(notes);

                  notesObj.splice(index, 1);

                  localStorage.setItem("notes", JSON.stringify(notesObj));

                  showNotes();
                }
              </script>
            </div>
            <script>
              // ===================================================disscution form============================
              const askButton = document.getElementById("ask-button");
              const questionTitleInput =
                document.getElementById("question-title");
              const questionContentInput =
                document.getElementById("question-content");
              const qnaList = document.getElementById("qna-list");

              askButton.addEventListener("click", () => {
                const title = questionTitleInput.value;
                const content = questionContentInput.value;

                if (title && content) {
                  createQnaPair(title, content);
                  questionTitleInput.value = "";
                  questionContentInput.value = "";
                }
              });

              function createQnaPair(question, answer) {
                const qnaDiv = document.createElement("div");
                qnaDiv.classList.add("qna-list");
                qnaDiv.innerHTML = `
        <h2>Q: ${question}</h2>
        <p>A: ${answer}</p>
      `;
                qnaList.appendChild(qnaDiv);
              }
            </script>
            <script>
              const filterButtons = document.querySelectorAll(".filter-button");
              const items = document.querySelectorAll(".item");

              filterButtons.forEach((button) => {
                button.addEventListener("click", () => {
                  filterButtons.forEach((btn) =>
                    btn.classList.remove("active")
                  );
                  button.classList.add("active");
                  const filter = button.getAttribute("data-filter");
                  items.forEach((item) => item.classList.remove("active"));
                  document
                    .querySelectorAll(`.${filter}`)
                    .forEach((item) => item.classList.add("active"));
                });
              });

              // Show the default button and items
              document
                .querySelector('.filter-button[data-filter="button1"]')
                .click();
            </script>
            <script src="script.js"></script>
          </div>
        </div>
      </div>
    </div>
   
    <script src="./video.js"></script>

    <script>
      let listVideo = document.querySelectorAll(".video-list .vid");
      let mainVideo = document.querySelector(".main-video video");
      let title = document.querySelector(".main-video .title");
      listVideo.forEach((video) => {
        video.onclick = () => {
          listVideo.forEach((vid) => vid.classList.remove("active"));
          video.classList.add("active");
          if (video.classList.contains("active")) {
            let src = video.children[0].getAttribute("src");
            mainVideo.src = src;
            let text = video.children[1].innerHTML;
            title.innerHTML = text;
          }
        };
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
  {% endwith %}
{% endblock %}
