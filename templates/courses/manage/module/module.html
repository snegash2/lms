{% extends '_base.html' %}
{% load static %}
{% load crispy_forms_tags %}

    {% block style %}
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cabin:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Cormorant+Upright:wght@300;400;600;700&family=Cormorant:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,700&family=Great+Vibes&family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Lexend:wght@100;200;300;400;500;600;700;800;900&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;0,1000;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900;1,1000&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Syne:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/84ceadd20f.js"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unicons.iconscout.com/release/v4.0.0/css/line.css"
    />
    <link rel="icon" href="{% static 'logo.png' %}" type="image/x-icon" />

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Course</title>

    <link rel="stylesheet" href="./footer.css" />
    <link rel="stylesheet" href="{% static 'instructor_module_add.css' %}" />
    <link rel="stylesheet" href="{% static 'instructor_module_add_main.css' %}" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"> -->

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />


    {% endblock %}
    <!-- new -->
  </head>

  <body class="main-body">

    {% block content %}
   {% include 'includes/Navbar.html' %}
    <script>
      // JavaScript to toggle the active class on hamburger click
      document.addEventListener("DOMContentLoaded", function () {
        var navbarHamburger = document.querySelector(".navbar-hamburger");
        var navbarMenu = document.querySelector(".navbar-menu");

        navbarHamburger.addEventListener("click", function () {
          navbarHamburger.classList.toggle("active");
          navbarMenu.classList.toggle("active");
        });

        document.addEventListener("click", function (event) {
          var targetElement = event.target;
          if (
            !targetElement.closest(".navbar") &&
            navbarHamburger.classList.contains("active")
          ) {
            navbarHamburger.classList.remove("active");
            navbarMenu.classList.remove("active");
          }
        });
      });
    </script>
    <!-- ===========================Main body================================= -->
    <!-- <button class="btn" onclick="openModulePopup()">Add Module</button> -->
    <button id="save-btns" class="btn" onclick="openModulePopup()">
      <span>Add Module/span>
    </button>
    <div id="modulePopupBackdrop" onclick="closeModulePopup()"></div>

    <div id="modulePopup">
      
      <form class="form" method="post" action=".">
        {% csrf_token %}
              {%for form in formset %}
              <div>
                  {{form|crispy}}
              </div>
          {%endfor%}

          {{ formset.management_form }}
      
          <button class="btn" onclick="saveModule()" type="submit">Save</button>
          <button class="btn" onclick="closeModulePopup()">Cancel</button>

    </form>
    </div>

    <table id="moduleTable">
      <tr>
        <th>Module Name</th>
        <th>Module Overview</th>
        <th>Actions</th>
      </tr>


        {%for module in course.modules.all%}
        <tr>
          <td>{{module.title|title}}</td>
          <td>{{module.description|safe}}</td>
          <td>Actions</td>
        </tr>
        {% endfor %}
      <!-- Table rows will be added dynamically using JavaScript -->
    </table>
      <br />
      <br />
      <br />
      <br />
      <br />

    <script>
      var editingRow = null; // To keep track of the row being edited

      function openModulePopup() {
        var modulePopupBackdrop = document.getElementById(
          "modulePopupBackdrop"
        );
        var modulePopup = document.getElementById("modulePopup");

        modulePopupBackdrop.classList.add("show");
        modulePopup.classList.add("show");
      }

      function closeModulePopup() {
        document.getElementById("moduleName").value = ""; // Reset module name
        document.getElementById("moduleOverview").value = ""; // Reset module overview
        editingRow = null;

        var modulePopupBackdrop = document.getElementById(
          "modulePopupBackdrop"
        );
        var modulePopup = document.getElementById("modulePopup");

        modulePopupBackdrop.classList.remove("show");
        modulePopup.classList.remove("show");
      }

      // Close the popup when clicking outside of it
      window.onclick = function (event) {
        var modulePopup = document.getElementById("modulePopup");
        if (event.target == modulePopup) {
          closeModulePopup();
        }
      };

      function saveModule() {
        var moduleName = document.getElementById("moduleName").value;
        var moduleOverview = document.getElementById("moduleOverview").value;

        if (moduleName && moduleOverview) {
          if (editingRow) {
            // Update the existing row
            editingRow.cells[0].innerHTML = moduleName;
            editingRow.cells[1].innerHTML = moduleOverview;
            editingRow = null; // Reset editingRow
          } else {
            // Add a new row
            var table = document.getElementById("moduleTable");
            var newRow = table.insertRow(table.rows.length);
            var cell1 = newRow.insertCell(0);
            var cell2 = newRow.insertCell(1);
            var cell3 = newRow.insertCell(2);

            cell1.innerHTML = moduleName;
            cell2.innerHTML = moduleOverview;
            cell3.innerHTML =
              '<button class="btn" onclick="editModule(this)">Edit</button>' +
              '<button class="btn" onclick="deleteModule(this)">Delete</button>';
          }

          closeModulePopup();
        } else {
          alert("Please enter both Module Name and Module Overview.");
        }
      }

      function editModule(btn) {
        var row = btn.parentNode.parentNode;
        var moduleName = row.cells[0].innerHTML;
        var moduleOverview = row.cells[1].innerHTML;

        // Set the values without resetting
        document.getElementById("moduleName").value = moduleName;
        document.getElementById("moduleOverview").value = moduleOverview;

        editingRow = row; // Set the editingRow to the current row

        openModulePopup();
      }

      function deleteModule(btn) {
        var row = btn.parentNode.parentNode;
        row.parentNode.removeChild(row);
      }
    </script>
    <!--  -->

    <!--  -->
    <script>
      // JavaScript to toggle the active class on hamburger click
      document.addEventListener("DOMContentLoaded", function () {
        var navbarHamburger = document.querySelector(".navbar-hamburger");
        var navbarMenu = document.querySelector(".navbar-menu");

        navbarHamburger.addEventListener("click", function () {
          navbarHamburger.classList.toggle("active");
          navbarMenu.classList.toggle("active");
        });

        document.addEventListener("click", function (event) {
          var targetElement = event.target;
          if (
            !targetElement.closest(".navbar") &&
            navbarHamburger.classList.contains("active")
          ) {
            navbarHamburger.classList.remove("active");
            navbarMenu.classList.remove("active");
          }
        });
      });
    </script>
    <!-- Catgory dropdown -->
    <script>
      const newdropdowns = document.querySelectorAll(".newdropdown");
      newdropdowns.forEach((newdropdown) => {
        const select = newdropdown.querySelector(".select");
        const caret = newdropdown.querySelector(".caret");
        const menu = newdropdown.querySelector(".menu");
        const options = newdropdown.querySelector(".menu li");
        const selected = newdropdown.querySelector(".selected");

        select.addEventListener("click", () => {
          select.classList.toggle("select-clicked");
          caret.classList.toggle("caret-rotate");
          menu.classList.toggle("menu-open");
        });
        options.forEach((option) => {
          option.addEventListener("click", () => {
            selected.innerText = option.innerText;
            select.classList.remove("select-clicked");
            caret.classList.remove("caret-rotate");
            menu.classList.remove("menu-open");
            options.forEach((option) => {
              option.classList.remove("active");
            });
            option.classList.add("active");
          });
        });
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>


   
    {% endblock %}

